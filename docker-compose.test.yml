# Docker Compose Override for Test Environment
# Uses mock data API instead of live NHL/MoneyPuck APIs
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.test.yml up
#   OR use: make test

services:
  backend:
    env_file:
      - ./watchgameupdates/.env.local
    depends_on:
      cloudtasks-emulator:
        condition: service_started
      mockdataapi:
        condition: service_started
    environment:
      - PORT=8080
      # These should be set in .env.local to point to mockdataapi container
      # PLAYBYPLAY_API_BASE_URL=http://mockdataapi-testserver-1:8125
      # STATS_API_BASE_URL=http://mockdataapi-testserver-1:8124

  scheduler:
    env_file:
      - ./watchgameupdates/.env.local
    environment:
      - SCHEDULE_FILE=/testdata/schedule.json
    volumes:
      - ./testdata:/testdata:ro

  mockdataapi:
    # Force pull latest image if available, or use existing
    pull_policy: if_not_present
    # Ensure mockdataapi is available for tests
    profiles:
      - test
